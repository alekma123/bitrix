<h4>Удалить дубликаты тел.</h4>


<style>
    .btn {
        cursor: pointer;
    }
    #output {
        max-width: 60vw;
        min-height: 200px;
        border: 1px solid black;
        height: auto;
        overflow: auto;
        word-break: break-word;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script type="text/javascript">

var index = 0;
var indexStop = 3;
var page = 0;

jQuery(document).ready(function($) {
    page = 0;
    $("#complete_script strong").text('');
    $("#run_script").click(function() {
        update();
    });
    $("#link_by_phone_work").click(function() {
        link_by_phone_work();
    });
    $("#status_operation #pager_current").text(page);
});

var update = function() {
        $("#complete_script strong").text('loading...');
        page++;
        $("#status_operation #pager_current").text(page);

        $.ajax({
            url: './api.php',         
            method: 'get',                 
            // data: { "page" : page },             
            dataType: 'json',          
            success: function(data) {   
                $('#error').html('');
               
                index++;
                console.log(data);
                $("#output").prepend(data['arr'] + ', ').fadeIn('slow');
                $("#result").prepend(data['text']).fadeIn('slow');
                $("#status_operation #totalDeals").html(data['total']);
                //$("#status_operation #updateDeals").html(data['status']['updateDeals']);
                
                //if (index == indexStop) { 
                    // вывести, когда отработает полностью скрипт     
                    //index = 0;
                    //  return; 
                    //}
                    //var refInterval = window.setTimeout('update()', 3000); // 3 seconds
                },
                error: function(err) {
                    console.log("Error: ", err);
                    let textError =  err.responseText;
                    $('#error').html(textError);
                },
                complete: function() {
                    $("#complete_script strong").text('...script was executed');
            }
        }); 
        
    };

</script>

<div>
    <button class="btn" id="run_script"> RUN SCRIPT...</button>
</div>

<h5 id="error"></h5>
<div id="status_operation">
    Всего контактов для обработки: <span id="totalDeals"></span>
    <br> 
    Кол-во контактов, успешно обработанных: <span id="updateDeals"></span>
</div>
<div id="complete_script">
    <strong></strong>
</div>
<div id="test">
</div>

<div id="output"></div>

<br><br>
<strong>RESULT:</strong>
<div id="result"></div>
